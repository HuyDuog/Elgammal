/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package khaibao;

import java.util.Base64;
import java.util.Random;
import javax.swing.JOptionPane;
import javax.swing.SpringLayout;

/**
 *
 * @author Lenovo
 */
public class elgamal_view extends javax.swing.JFrame {

    /**
     * Creates new form elgamal_view
     */
    public elgamal_view() {
        initComponents();
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">                          
    private void initComponents() {

        jDialog1 = new javax.swing.JDialog();
        jLayeredPane1 = new javax.swing.JLayeredPane();
        jLabel1 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        sop = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        soa = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        sod = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        sox = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        sok = new javax.swing.JTextField();
        soy = new javax.swing.JTextField();
        jButton2 = new javax.swing.JButton();
        jLabel13 = new javax.swing.JLabel();
        jTextField8 = new javax.swing.JTextField();
        jPanel3 = new javax.swing.JPanel();
        jLabel14 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jTextField9 = new javax.swing.JTextField();
        jButton3 = new javax.swing.JButton();
        jLabel18 = new javax.swing.JLabel();
        jTextField12 = new javax.swing.JTextField();
        jButton4 = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();

        javax.swing.GroupLayout jDialog1Layout = new javax.swing.GroupLayout(jDialog1.getContentPane());
        jDialog1.getContentPane().setLayout(jDialog1Layout);
        jDialog1Layout.setHorizontalGroup(
            jDialog1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        jDialog1Layout.setVerticalGroup(
            jDialog1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 300, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout jLayeredPane1Layout = new javax.swing.GroupLayout(jLayeredPane1);
        jLayeredPane1.setLayout(jLayeredPane1Layout);
        jLayeredPane1Layout.setHorizontalGroup(
            jLayeredPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        jLayeredPane1Layout.setVerticalGroup(
            jLayeredPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jLabel1.setFont(new java.awt.Font("Times New Roman", 0, 24)); // NOI18N
        jLabel1.setText("Hệ mã hóa Elgamal");

        jLabel3.setText("Tạo khóa");

        jLabel4.setText("Public key (p,a,d)");

        jLabel5.setText("Số nguyên tố (p):");

        jLabel6.setText("Số alpha (a):");

        jLabel7.setText("Số d (a^x mod p):");

        sod.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sodActionPerformed(evt);
            }
        });

        jLabel8.setText("Private key (x)");

        jLabel9.setText("Số nguyên x : ");

        jButton1.setText("Tạo khóa");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                            .addGap(37, 37, 37)
                            .addComponent(jLabel9)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(sox, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                            .addGap(35, 35, 35)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addGroup(jPanel1Layout.createSequentialGroup()
                                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jLabel5)
                                        .addComponent(jLabel6))
                                    .addGap(13, 13, 13)
                                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(soa, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(sop, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addGroup(jPanel1Layout.createSequentialGroup()
                                    .addComponent(jLabel7)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                    .addComponent(sod, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(jLabel8)))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(80, 80, 80)
                        .addComponent(jButton1))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(96, 96, 96)
                        .addComponent(jLabel3)))
                .addContainerGap(32, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(7, 7, 7)
                .addComponent(jLabel4)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(sop, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(soa, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(sod, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel8)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel9))
                    .addComponent(sox, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(41, 41, 41)
                .addComponent(jButton1)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        jLabel2.setText("Mã hóa");

        jLabel10.setText("Bản rõ");

        jLabel11.setText("Số ngẫu nhiên k: ");

        jLabel12.setText("Y (a^k mod p) :");

        jButton2.setText("Mã hóa");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        jLabel13.setText("Bản mã tương ứng");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(140, 140, 140)
                        .addComponent(jLabel2))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(26, 26, 26)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jLabel10)
                            .addComponent(jTextField1)
                            .addComponent(jLabel13)
                            .addComponent(jTextField8, javax.swing.GroupLayout.DEFAULT_SIZE, 253, Short.MAX_VALUE)))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(86, 86, 86)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel12)
                                .addGap(18, 18, 18)
                                .addComponent(soy, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel11)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(sok, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addGap(37, 37, 37)
                                .addComponent(jButton2)))))
                .addContainerGap(56, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2)
                .addGap(13, 13, 13)
                .addComponent(jLabel10)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, 75, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(sok, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel12)
                    .addComponent(soy, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jButton2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel13)
                .addGap(18, 18, 18)
                .addComponent(jTextField8, javax.swing.GroupLayout.PREFERRED_SIZE, 94, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(51, Short.MAX_VALUE))
        );

        jLabel14.setText("Giải mã");

        jLabel15.setText("Bản mã nhận được");

        jButton3.setText("Giải mã");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });

        jLabel18.setText("Bản rõ tương ứng");
        jLabel18.setToolTipText("");

        jButton4.setText("Tạo mới");
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });

        jButton5.setText("Thoát");
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(140, 140, 140)
                        .addComponent(jLabel14))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(121, 121, 121)
                        .addComponent(jButton3))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addGap(26, 26, 26)
                        .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel3Layout.createSequentialGroup()
                                .addComponent(jButton4)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jButton5))
                            .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addComponent(jLabel15)
                                .addComponent(jTextField9)
                                .addComponent(jLabel18)
                                .addComponent(jTextField12, javax.swing.GroupLayout.DEFAULT_SIZE, 253, Short.MAX_VALUE)))))
                .addContainerGap(36, Short.MAX_VALUE))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel14)
                .addGap(13, 13, 13)
                .addComponent(jLabel15)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jTextField9, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jButton3)
                .addGap(19, 19, 19)
                .addComponent(jLabel18)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jTextField12, javax.swing.GroupLayout.PREFERRED_SIZE, 94, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton4)
                    .addComponent(jButton5))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(375, 375, 375)
                        .addComponent(jLabel1))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(27, 27, 27)
                        .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(33, 33, 33)
                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(29, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addComponent(jLabel1)
                .addGap(35, 35, 35)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>                        

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {                                         
        reset();
    //bt_taoKhoa_Click();// TODO add your handling code here:    
    }                                        

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {                                         
        if (danhdau != 1)
            {
               JOptionPane.showMessageDialog(rootPane,"Bạn chưa chọn khóa!");
               
            }
              else
            {
                if (jTextField1.getText() == null)
                {
                    JOptionPane.showMessageDialog(rootPane,"Bạn chưa nhập chuỗi cần mã hóa!");
                }
                else
                {
                    if (danhdau == 1)
                    {
                        jTextField8.setText(null);

                        String Egm_chuoiMaHoa = E_Mahoa(jTextField1.getText());
                        jTextField8.setText(Egm_chuoiMaHoa);
                        jTextField9.setText (Egm_chuoiMaHoa);
                        danhdau = 2;
                       // btMaHoa.IsEnabled = false;
                       // btGiaiMa.IsEnabled = true;
                    }
                }
            }// TODO add your handling code here:
    }                                        

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {                                         
       
        

            if (danhdau != 2)
            {
               JOptionPane.showMessageDialog(rootPane,"Bạn chưa chọn tệp giải mã!");
            }
            if (danhdau == 2)
            {
                jTextField12.setText(null);
                String giaima = E_GiaiMa(jTextField9.getText());
                jTextField12.setText(giaima);
                        
            }
            danhdau = 1;
            //btMaHoa.IsEnabled = false;
            //btGiaiMa.IsEnabled = false;
        
// TODO add your handling code here:
    }                                        

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {                                         
       System.exit(0); // TODO add your handling code here:
    }                                        

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {                                         
        soa.getText();
        sop.getText(); 
        sod.getText(); 
        sox.getText();
        sok.getText();
        soy.getText();
        jButton2.isEnabled(); // TODO add your handling code here:
    }                                        

    private void sodActionPerformed(java.awt.event.ActionEvent evt) {                                    
      //  EsoD = E_luythuamodulo(EsoA, EsoX, EsoP); // TODO add your handling code here:
    }                                   
    private void reset ()
    {
        soa.getText();
        sop.getText(); 
        sod.getText(); 
        sox.getText();
        sok.getText();
        soy.getText();
    }
    public int EsoA , EsoQ , EsoGA, EsoP , EsoX , EsoD, EsoK, EsoY;
    public int danhdau = 0;
    private boolean E_kiemtrasonguyento(int so_kt)
    {
      boolean kiemtra = true;
      if (so_kt == 2 || so_kt == 3)
      {return kiemtra; }
      else 
      {
          if (so_kt == 1 || so_kt %2 == 0|| so_kt % 3 == 0 )
          {kiemtra = false;}
          else
          {
              for (int i=5 ; i<= Math.sqrt(so_kt);i=i+6)
                  if(so_kt % i == 0|| so_kt % (i+2)==0)
                  {kiemtra=false ; break;}
          }
      }
      return kiemtra;
    }
    private boolean E_kiemtrauoccuasoP(int soP, int soQ)
    {
        boolean kt_ok = true ; 
        if ((soP -1) % soQ  == 0 ) 
        {kt_ok=true;}
        else
        {kt_ok = false;}
        return kt_ok;
    }
    private boolean E_kiemtraphantusinh (int so_kt, int EsoP, int EsoQ)
    {
        boolean ktok = true;
        int soMu = EsoP-1/EsoQ;
        int kq = E_luythuamodulo(so_kt, soMu,EsoP);
        if (kq != 1) {
            ktok= true;
        } else { if(kq == 1) ktok= false;}
        return ktok;
    }
         private boolean nguyenToCungNhau(int ai, int bi)// "Hàm kiểm tra hai số nguyên tố cùng nhau"
        {
            boolean ktx;
            // giải thuật Euclid;
            int temp;
            while (bi != 0)
            {
                temp = ai % bi;
                ai = bi;
                bi = temp;
            }
            if (ai == 1) { ktx = true; }
            else ktx = false;
            return ktx;
        }
         private String TapP_1(int soDauVao)
        {
            String ChuoiDauRa = null;
            for (int i = 1; i < soDauVao; i++)
            {
                if (nguyenToCungNhau(soDauVao, i) == true)
                { ChuoiDauRa += String.valueOf(i) + "#"; }
            }
            System.out.println(ChuoiDauRa);
            return ChuoiDauRa;
        }
        private String Tap_Qi(int soDauvao) {
            String ChuoiDauRa = null;
          int soix = 2;
            while (soDauvao != 1)
            {
               if (soDauvao % soix == 0)
                {
                    ChuoiDauRa += String.valueOf(soix) + "#";
                    soDauvao = soDauvao / soix;
               }
                else soix++;
           }
            return ChuoiDauRa;
           }
        public int E_luythuamodulo(int coso, int soMu, int soModulo)
        {
            int[] a = new int[100];
            int k = 0;
            do
            {
                a[k] = soMu % 2;
                k++;
                soMu = soMu / 2;
            }
            while (soMu != 0);
            //Quá trình lấy dư
            int kq = 1;

            for (int i = k - 1; i >= 0; i--)
            {
                kq = (kq * kq) % soModulo;
                if (a[i] == 1)
                    kq = (kq * coso) % soModulo;
            }
            return kq;
        }
        private int E_tinhModulo_nghichdao(int SoNCNDn, int SoMdlm)
        {
            int kd = SoMdlm;
            int r = 1, q, y0 = 0, y1 = 1, y = 0;
            while (SoNCNDn != 0)
            {
                r = SoMdlm % SoNCNDn;
                if (r == 0)
                    break;
                else
                {
                    q = SoMdlm / SoNCNDn;
                    y = y0 - y1 * q;
                    SoMdlm = SoNCNDn;
                    SoNCNDn = r;
                    y0 = y1;
                    y1 = y;
                }
            }
            if (y >= 0)
                return y;
            else
            {
                y = kd + y;
                return y;
            }
        }
        private int E_TinhC1muxModP(int SoC1, int SomuX, int somDLP)
        {
            int kq_E_TinhC1muxModP = 1;
            for (int i = 0; i <= SomuX; i++)
            {
                kq_E_TinhC1muxModP = kq_E_TinhC1muxModP * E_tinhModulo_nghichdao(SoC1, somDLP);
            }
            return kq_E_TinhC1muxModP;
        }
        private void taokhoa()
        {
            EsoQ =  EsoGA = EsoA = EsoX = EsoD = EsoK = 0;
          
            // chọn số nguyên tố ngẫu nhiên Q thỏa mãn Q là ước của P - 1;
            do
            {
                Random rdQ = new Random();
                EsoQ = rdQ.nextInt(EsoP - 1);
            }
            while (!E_kiemtrasonguyento(EsoP) || !E_kiemtrauoccuasoP(EsoP, EsoQ));
            // tìm số G để tìm số A (A là phần tử sinh): 
            do
            {
                Random rdEsoGA = new Random();
                EsoGA = rdEsoGA.nextInt(EsoP - 1);
            }
            while (!E_kiemtraphantusinh(EsoGA, EsoP, EsoQ));

            EsoA = E_luythuamodulo(EsoGA, EsoP - 1 / EsoQ, EsoP); // phần tử sinh

            do
            {
                Random rdEsoX = new Random();
                EsoX = rdEsoX.nextInt(EsoP - 2);
            }
            while (EsoX == EsoQ || EsoX == EsoGA);
            // d= a^x mod P
            EsoD = E_luythuamodulo(EsoA, EsoX, EsoP);// beta; d          
            do
            {
                Random rdEsoK = new Random();
                EsoK = rdEsoK.nextInt(EsoP - 2);
            }
            while (EsoK == EsoX || EsoK == EsoA || EsoK == EsoQ || EsoK == EsoGA || !nguyenToCungNhau(EsoK, EsoP - 1));
            // Tính Y = A^k mod p - Khóa công khai
            EsoY = E_luythuamodulo(EsoA, EsoK, EsoP);
        }
         private void bt_taoKhoa_Click()
        {
            
                    // thực hiện thao tác tạo khóa tùy chọn 
                    if (sop.getText() == "")
                    {
                        JOptionPane.showMessageDialog(rootPane,"Phải nhập số P ");
                    }
                    else
                    {
                        EsoP = Integer.parseInt(sop.getText());
                        if (E_kiemtrasonguyento(EsoP) == false)
                        {
                            JOptionPane.showMessageDialog(rootPane,"Phải chọn P là số nguyên tố ");
                        }
                        else
                            if (EsoP < 1000)
                            {
                                JOptionPane.showMessageDialog(rootPane,"Số P quá nhỏ! Nhập số khác ");
                                
                            }
                            else
                            {
                                taokhoa();
                                sop.getText();
                                soa.getText();
                                sox.getText();
                               sod.getText();
                                sok.getText();
                               soy.getText();

                            }
                    } danhdau = 1;
                //btMaHoa.IsEnabled = true;
                }
               public   String E_Mahoa (String Chuoivao)
               {
                   int[] mh_temp3 = new int [Chuoivao.length()];
                    for (int i = 0; i < Chuoivao.length(); i++)
            {
                mh_temp3[i] = ((Chuoivao.length() % EsoP) * (E_luythuamodulo(EsoD,EsoK,EsoP)) % EsoP);  
            }
                    String str = "";
            for (int i = 0; i < mh_temp3.length; i++)
            {
                str = str + (char)mh_temp3[i];
                // txtm3.Text = (char)mh_temp3[i] + "#";
            }
        return null;
        
               }
               public String E_GiaiMa(String ChuoiVao)
               {
                   int[] Ec = new int[ChuoiVao.length()];
            int sor = E_luythuamodulo(EsoY, (EsoP - (1 + EsoX)), EsoP);
            //txtm7.Text = sor.ToString();
            for (int i = 0; i < Ec.length; i++)
            {
                Ec[i] = (ChuoiVao.length() * sor) % EsoP;// giải mã

            }
            String str = "";
            for (int i = 0; i < Ec.length; i++)
            {
                str = str + (char)Ec[i];
            }
        return null;
               }
               
           
        
        
        
         
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(elgamal_view.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(elgamal_view.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(elgamal_view.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(elgamal_view.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new elgamal_view().setVisible(true);
            }
            
           
        }); 
        
        
        
    }

    // Variables declaration - do not modify                     
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JDialog jDialog1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JLayeredPane jLayeredPane1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField12;
    private javax.swing.JTextField jTextField8;
    private javax.swing.JTextField jTextField9;
    private javax.swing.JTextField soa;
    private javax.swing.JTextField sod;
    private javax.swing.JTextField sok;
    private javax.swing.JTextField sop;
    private javax.swing.JTextField sox;
    private javax.swing.JTextField soy;
    // End of variables declaration                   
}
